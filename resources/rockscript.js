!function(){var t,e={}.hasOwnProperty,n=[].slice;window.requestAnimationFrame||(window.requestAnimationFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)}),window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia),window.using=function(t,e){return e.call(t)},window.extend=function(t,n){var i,r;for(i in n)e.call(n,i)&&(r=n[i],t[i]=r);return t},window.EventEmitter=t=function(){function t(){this.events={}}return t.prototype.emit=function(){var t,e,i,r,o,a;if(e=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],!this.events[e])return!1;for(a=this.events[e],r=0,o=a.length;o>r;r++)i=a[r],i.apply(null,t);return!0},t.prototype.addListener=function(t,e){var n;return this.emit("newListener",t,e),(null!=(n=this.events)[t]?(n=this.events)[t]:n[t]=[]).push(e),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(t,e){var n,i=this;return n=function(){return i.removeListener(t,n),e.apply(null,arguments)},this.on(t,n),this},t.prototype.removeListener=function(t,e){var n;return this.events[t]?(this.events[t]=function(){var i,r,o,a;for(o=this.events[t],a=[],i=0,r=o.length;r>i;i++)n=o[i],n!==e&&a.push(n);return a}.call(this),this):this},t.prototype.removeAllListeners=function(t){return delete this.events[t],this},t}()}.call(this),function(){var t=[].slice;window.UI={createSwitch:function(t){var e,n,i,r,o;return e=document.createElement("li"),o=document.createElement("input"),o.type="checkbox",o.setAttribute("data-icon1","◡̍"),o.setAttribute("data-icon2","∅"),i=!0,r=function(){return PedalBoard.emit("toggle",t.toLowerCase(),i)},o.addEventListener("click",function(){return i=!i,r()}),PedalBoard.on("toggle",function(e,n){var r;if(e===t.toLowerCase())return i=n,r=i===!1?"off":"on",o.className=r,o.checked=!i,localStorage[t]=r}),"off"===localStorage[t]&&(i=!1,r()),n=document.createElement("label"),n.innername=t,e.appendChild(o),e.appendChild(n),document.querySelector(".pedals .switches").appendChild(e),e},createDistortionSelector:function(){var t,e,n,i,r,o,a;for(t=document.querySelector(".distortion"),a="ABCDE",e=r=0,o=a.length;o>r;e=++r)i=a[e],n=document.createElement("input"),n.type="radio",n.name="distortion",n.id="distortion_"+i,OVERDRIVES[i]===OVERDRIVES.current&&(n.checked=!0),n.setAttribute("data-icon",i),t.appendChild(n),n.addEventListener("change",function(){var t;if(this.checked)return t=this.getAttribute("data-icon"),PedalBoard.emit("distortion",t)});return PedalBoard.on("distortion",function(t){return document.querySelector("#distortion_"+t).checked=!0})}},window.EffectControl=function(){function e(t,e,n){this.context=e,this.callback=n,this.folder=gui.addFolder(t)}return e.prototype.add=function(){var e,n;return e=1<=arguments.length?t.call(arguments,0):[],n=this.folder.add.apply(this.folder,[this.context].concat(e)),n.onFinishChange(this.callback),n.step(.1),n},e}()}.call(this),function(){var t;t=function(){function t(t){this.set=t}return t.prototype.link=function(){var t,e,n,i,r,o,a;for(a=this.set,t=r=0,o=a.length;o>r;t=++r)i=a[t],n=this.set[t+1],e=(null!=n?n.input:void 0)||n,e&&i.connect(e),i.chained=!0;return this.set.slice(-1)[0].chained=!0},t.prototype.prepare=function(t,e){var n,i,r,o;for("number"!=typeof t&&(t=this.set.indexOf(t)),o=this.set[t],i=this.set[t+1],n=2;i&&!i.chained;)i=this.set[t+n],n++;for(r=this.set[t-1],n=2;r&&!r.chained;)r=this.set[t-n],n++;return i&&r?e(o,i,r):void 0},t.prototype.disconnect=function(t){return console.log("disconnecting",t),this.prepare(t,function(t,e,n){return t.disconnect(0),n.disconnect(0),n.connect(e.input||e),t.chained=!1})},t.prototype.connect=function(t){return console.log("connecting",t),this.prepare(t,function(t,e,n){return n.disconnect(0),n.connect(t.input||t),t.connect(e.input||e),t.chained=!0})},t.prototype.toggle=function(t){return"number"==typeof t&&(t=this.set[t]),this[t.chained?"disconnect":"connect"](t),t.chained},t.prototype.indexOf=function(t){return this.set.indexOf(t)},t.prototype.replace=function(t,e){var n;return n="number"!=typeof t?this.set.indexOf(t):t,this.disconnect(n),this.set.splice(n,1,e),this.connect(n)},t}(),window.AudioChain=t}.call(this),function(){var t,e,n,i=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};window.SpectrumVisualizer=function(){function t(t,e){this.analyser=t,this.options=e,this.stop=i(this.stop,this),this.start=i(this.start,this),this.draw=i(this.draw,this),this.analyser.fftSize=2048}return t.prototype.setup=function(){return this.canvas=document.createElement("canvas"),document.getElementById("meters").appendChild(this.canvas),this.canvas.width=400,this.canvas.height=160,this.ctx=this.canvas.getContext("2d")},t.prototype.draw=function(){var t,e,n,i,r,o,a,s,c,u;for(this.running&&requestAnimationFrame(this.draw,this.canvas),i=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(i),this.ctx.fillStyle="rgba(0,0,0,0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#abf",e=96,n=i.length-256,a=Math.floor(n/e),s=2,t=Math.floor(this.canvas.width/e-s),u=[],r=c=0;e>=0?e>=c:c>=e;r=e>=0?++c:--c)o=i[r*a],u.push(this.ctx.fillRect(r*(t+s),this.canvas.height,t,.7*-o));return u},t.prototype.start=function(){return this.running=!0,this.draw()},t.prototype.stop=function(){return this.running=!1},t.prototype.run=function(){return this.setup(),this.start()},t}(),window.MeterViz=function(t){function n(){return this.draw=i(this.draw,this),e=n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.setup=function(){var t,e,n,i,r;for(this.meters=[],t=document.getElementById("meters"),r=[],e=i=0;16>=i;e=++i)n=document.createElement("meter"),n.value=0,n.high=.8,t.appendChild(n),r.push(this.meters.push(n));return r},n.prototype.draw=function(){var t,e,n,i,r,o,a,s,c,u;for(this.running&&setTimeout(this.draw,1e3/15),e=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(e),t=e.length-512,o=Math.floor(t/this.meters.length),c=this.meters,u=[],n=a=0,s=c.length;s>a;n=++a)r=c[n],i=e[n*o],u.push(r.value=i/192);return u},n}(SpectrumVisualizer),t=function(){function t(t,e){this.x=t,this.y=e}return t}(),window.SpaceViz=function(e){function r(){return this.draw=i(this.draw,this),n=r.__super__.constructor.apply(this,arguments)}return o(r,e),r.prototype.makeCanvas=function(t){var e;return e=document.createElement("canvas"),e.className=t,document.getElementById("meters").appendChild(e),e.width=window.innerWidth,e.height=window.innerHeight/2,e.style.marginTop=-Math.floor(e.height/2)+"px",e},r.prototype.setup=function(){return this.canvas=this.makeCanvas("spaceviz"),this.ctxbars=this.canvas.getContext("2d"),this.cwave=this.makeCanvas("spaceviz-wave"),this.ctxwave=this.cwave.getContext("2d")},r.prototype.draw=function(){var e,n,i,r,o,a,s,c,u,h,d,l,p,f,v,w,m,g,y,x,E,R,V,S,O;for(this.running&&requestAnimationFrame(this.draw,this.canvas),a=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(a),this.ctxbars.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctxwave.clearRect(0,0,this.cwave.width,this.cwave.height),o=[30,30,255,.8],this.ctxbars.fillStyle="rgba("+o+")",n=200,r=a.length-128,p=Math.floor(r/n),v=2,e=Math.ceil(this.canvas.width/n-v),f=10,w=new t(-10,this.canvas.height/2),d=[w],i=0,c=E=0;n>=0?n>=E:E>=n;c=n>=0?++E:--E)u=a[c*p],s=0|u/256*this.canvas.height,h=0|(this.canvas.height-s)/2,o[0]=o[1]=0|196-u/2,o[2]=192+(0|u/4),o[3]=(u/256).toFixed(2),this.ctxbars.fillStyle="rgba("+o+")",m=c*(e+v),y=h,this.ctxbars.fillRect(m,y,e,s),10>u&&(y+=0|2*(Math.random()-.5)),10===c%f?d.push(new t(m,y)):0===c%f&&d.push(new t(m,y+s)),30===c&&u>140&&(document.body.classList.add("boom"),clearTimeout(i),i=setTimeout(function(){return document.body.classList.remove("boom")},350));for(l=[w],this.ctxwave.lineWidth=2,this.ctxwave.strokeStyle="rgba(255,255,255, 0.5)",this.ctxwave.beginPath(),this.ctxwave.moveTo(0,this.canvas.height/2),c=R=1,S=d.length-2;S>=1?S>R:R>S;c=S>=1?++R:--R)g=(d[c].x+d[c+1].x)/2,x=(d[c].y+d[c+1].y)/2,this.ctxwave.quadraticCurveTo(d[c].x,d[c].y,g,x),l.push(new t(d[c].x,this.canvas.height-d[c].y));for(this.ctxwave.quadraticCurveTo(d[c].x,d[c].y,d[c+1].x,d[c+1].y),this.ctxwave.stroke(),this.ctxwave.lineWidth=3,this.ctxwave.strokeStyle="rgba(150,150,255, 0.2)",this.ctxwave.beginPath(),this.ctxwave.moveTo(0,this.canvas.height/2),c=V=1,O=l.length-2;O>=1?O>V:V>O;c=O>=1?++V:--V)g=(l[c].x+l[c+1].x)/2,x=(l[c].y+l[c+1].y)/2,this.ctxwave.quadraticCurveTo(l[c].x,l[c].y,g,x);return this.ctxwave.stroke()},r}(SpectrumVisualizer)}.call(this),function(){var t,e,n,i,r,o,a,s,c,u,h,d,l,p,f,v,w,m,g,y,x,E;for(window.gui=new dat.GUI,window.PedalBoard=new EventEmitter,i=new AudioContext,n=i.createAnalyser(),p=new Tuna(i),o=i.createGainNode(),o.gain.value=6,window.OVERDRIVES={},window.createOverdrive=function(t,e){var n,i;return n={outputGain:.7,drive:1,curveAmount:.7,algorithmIndex:0,bypass:0},extend(n,e),OVERDRIVES[t]=new p.Overdrive(n),OVERDRIVES[t]._name=t,(i=OVERDRIVES["options_"+t])?extend(i,n):OVERDRIVES["options_"+t]=n},v=function(t){return"string"!=typeof t&&(t=OVERDRIVES.current._name),createOverdrive(t,OVERDRIVES["options_"+t]),OVERDRIVES.set(t)},OVERDRIVES.set=function(t){return"string"==typeof t&&(t=OVERDRIVES[t]),chain.replace(OVERDRIVES.current,t),OVERDRIVES.current=t},y="ABCDE",a=m=0,g=y.length;g>m;a=++m)c=y[a],u={algorithmIndex:a},(h=null!=(x=gui.load)?null!=(E=x.remembered)?E[gui.preset][a]:void 0:void 0)&&extend(u,h),createOverdrive(c,u),u=OVERDRIVES["options_"+c],gui.remember(u),using(new EffectControl("Overdrive "+c,u,v),function(){return this.add("outputGain",0,1),this.add("drive",0,1),this.add("curveAmount",0,1)});OVERDRIVES.current=OVERDRIVES.A,t={feedback:.6,delayTime:150,wetLevel:.8,dryLevel:.5,cutoff:8e3,bypass:0},r=new p.Delay(t),f=function(){return chain.replace(r,new p.Delay(t))},using(new EffectControl("Delay",t,f),function(){return this.add("feedback",0,1),this.add("delayTime",0,1e3),this.add("wetLevel",0,1),this.add("dryLevel",0,1),this.add("cutoff",20,22050)}),e={intensity:.3,rate:.1,stereoPhase:0,bypass:0},l=new p.Tremolo(e),w=function(){return chain.replace(l,new p.Tremolo(e))},using(new EffectControl("Tremolo",e,w),function(){return this.add("intensity",0,1),this.add("rate",0,8),this.add("stereoPhase",0,180)}),d=function(){var t;return t={overdrive:chain.indexOf(OVERDRIVES.current),delay:chain.indexOf(r),tremolo:chain.indexOf(l)},this.on("toggle",function(e){return chain.toggle(t[e])}),this.on("distortion",function(t){return OVERDRIVES.set(t)})},s=function(t){var e,a;return a=i.createMediaStreamSource(t),window.chain=new AudioChain([a,n,o,OVERDRIVES.current,r,l,i.destination]),chain.link(),UI.createSwitch("Overdrive",chain.indexOf(OVERDRIVES.current)),UI.createDistortionSelector(OVERDRIVES.current),UI.createSwitch("Delay",chain.indexOf(r)),UI.createSwitch("Tremolo",chain.indexOf(l)),n.minDecibels=-65,e=document.querySelector(".screenview")?new SpaceViz(n):new MeterViz(n),e.run(),using(PedalBoard,d)},navigator.getUserMedia({audio:!0},s)}.call(this),function(){var t;t=io.connect(),t.on("toggle",function(t,e){return console.log("toggle",t,e),PedalBoard.emit("toggle",t,e)}),t.on("distortion",function(t){return console.log("select distortion",t),PedalBoard.emit("distortion",t)})}.call(this);